!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self).popmotion={})}(this,(function(t){"use strict";var r=function(t,n){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])})(t,n)};function n(t,n){function e(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var e=function(){return(e=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t}).apply(this,arguments)};function o(t,r){var n={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(n[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(e=Object.getOwnPropertySymbols(t);o<e.length;o++)r.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(t,e[o])&&(n[e[o]]=t[e[o]])}return n}function u(){for(var t=0,r=0,n=arguments.length;r<n;r++)t+=arguments[r].length;var e=Array(t),o=0;for(r=0;r<n;r++)for(var u=arguments[r],i=0,a=u.length;i<a;i++,o++)e[o]=u[i];return e}var i=function(t,r){var n=this,e=t.middleware,o=t.onComplete;this.isActive=!0,this.update=function(t){n.observer.update&&n.updateObserver(t)},this.complete=function(){n.observer.complete&&n.isActive&&n.observer.complete(),n.onComplete&&n.onComplete(),n.isActive=!1},this.error=function(t){n.observer.error&&n.isActive&&n.observer.error(t),n.isActive=!1},this.observer=r,this.updateObserver=function(t){return r.update(t)},this.onComplete=o,r.update&&e&&e.length&&e.forEach((function(t){return n.updateObserver=t(n.updateObserver,n.complete)}))},a=function(t,r,n){var e=r.middleware;return new i({middleware:e,onComplete:n},"function"==typeof t?{update:t}:t)},s=function(t,r){return function(n){return Math.max(Math.min(n,r),t)}},c=function(t){return t%1?Number(t.toFixed(5)):t},f=/(-)?(\d[\d\.]*)/g,p=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,d=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))$/i,l={test:function(t){return"number"==typeof t},parse:parseFloat,transform:function(t){return t}},v=e(e({},l),{transform:s(0,1)}),h=(e(e({},l),{default:1}),function(t){return{test:function(r){return"string"==typeof r&&r.endsWith(t)&&1===r.split(" ").length},parse:parseFloat,transform:function(r){return""+r+t}}}),m=h("deg"),y=h("%"),g=h("px"),b=h("vh"),w=h("vw"),O=(e(e({},y),{parse:function(t){return y.parse(t)/100},transform:function(t){return y.transform(100*t)}}),s(0,255)),M=function(t){return void 0!==t.red},A=function(t){return void 0!==t.hue},x=function(t){return function(r){if("string"!=typeof r)return r;for(var n={},e=function(t){return t.substring(t.indexOf("(")+1,t.lastIndexOf(")"))}(r).split(/,\s*/),o=0;o<4;o++)n[t[o]]=void 0!==e[o]?parseFloat(e[o]):1;return n}},C=e(e({},l),{transform:function(t){return Math.round(O(t))}});function k(t,r){return t.startsWith(r)&&d.test(t)}var S,j={test:function(t){return"string"==typeof t?k(t,"rgb"):M(t)},parse:x(["red","green","blue","alpha"]),transform:function(t){var r=t.red,n=t.green,e=t.blue,o=t.alpha,u=void 0===o?1:o;return function(t){var r=t.red,n=t.green,e=t.blue,o=t.alpha;return"rgba("+r+", "+n+", "+e+", "+(void 0===o?1:o)+")"}({red:C.transform(r),green:C.transform(n),blue:C.transform(e),alpha:c(v.transform(u))})}},P={test:function(t){return"string"==typeof t?k(t,"hsl"):A(t)},parse:x(["hue","saturation","lightness","alpha"]),transform:function(t){var r=t.hue,n=t.saturation,e=t.lightness,o=t.alpha,u=void 0===o?1:o;return function(t){var r=t.hue,n=t.saturation,e=t.lightness,o=t.alpha;return"hsla("+r+", "+n+", "+e+", "+(void 0===o?1:o)+")"}({hue:Math.round(r),saturation:y.transform(c(n)),lightness:y.transform(c(e)),alpha:c(v.transform(u))})}},F=e(e({},j),{test:function(t){return"string"==typeof t&&k(t,"#")},parse:function(t){var r="",n="",e="";return t.length>4?(r=t.substr(1,2),n=t.substr(3,2),e=t.substr(5,2)):(r=t.substr(1,1),n=t.substr(2,1),e=t.substr(3,1),r+=r,n+=n,e+=e),{red:parseInt(r,16),green:parseInt(n,16),blue:parseInt(e,16),alpha:1}}}),V=function(t){return"string"==typeof t&&d.test(t)||M(t)||A(t)},E=function(t){return j.test(t)?j.parse(t):P.test(t)?P.parse(t):F.test(t)?F.parse(t):t},T=function(t){return M(t)?j.transform(t):A(t)?P.transform(t):t},D=function(t){return"number"==typeof t?0:t},_={test:function(t){if("string"!=typeof t||!isNaN(t))return!1;var r=0,n=t.match(f),e=t.match(p);return n&&(r+=n.length),e&&(r+=e.length),r>0},parse:function(t){var r=t,n=[],e=r.match(p);e&&(r=r.replace(p,"${c}"),n.push.apply(n,e.map(E)));var o=r.match(f);return o&&n.push.apply(n,o.map(l.parse)),n},createTransformer:function(t){var r=t,n=0,e=t.match(p),o=e?e.length:0;if(e)for(var u=0;u<o;u++)r=r.replace(e[u],"${c}"),n++;var i=r.match(f),a=i?i.length:0;if(i)for(u=0;u<a;u++)r=r.replace(i[u],"${n}"),n++;return function(t){for(var e=r,u=0;u<n;u++)e=e.replace(u<o?"${c}":"${n}",u<o?T(t[u]):c(t[u]));return e}},getAnimatableNone:function(t){var r=_.parse(t);return _.createTransformer(t)(r.map(D))}},q=0,N="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(t){return window.requestAnimationFrame(t)}:function(t){var r=Date.now(),n=Math.max(0,16.7-(r-q));q=r+n,setTimeout((function(){return t(q)}),n)},$=1/60*1e3,I=!0,R=!1,W=!1,B={delta:0,timestamp:0},K=["read","update","render","postRender"],U=function(t){return R=t},G=K.reduce((function(t,r){return t[r]=function(t){var r=[],n=[],e=0,o=!1,u=0,i=new WeakSet,a=new WeakSet,s={cancel:function(t){var r=n.indexOf(t);i.add(t),-1!==r&&n.splice(r,1)},process:function(c){var f,p;if(o=!0,r=(f=[n,r])[0],(n=f[1]).length=0,e=r.length)for(u=0;u<e;u++)(p=r[u])(c),!0!==a.has(p)||i.has(p)||(s.schedule(p),t(!0));o=!1},schedule:function(t,u,s){void 0===u&&(u=!1),void 0===s&&(s=!1);var c=s&&o,f=c?r:n;i.delete(t),u&&a.add(t),-1===f.indexOf(t)&&(f.push(t),c&&(e=r.length))}};return s}(U),t}),{}),H=K.reduce((function(t,r){var n=G[r];return t[r]=function(t,r,e){return void 0===r&&(r=!1),void 0===e&&(e=!1),R||Q(),n.schedule(t,r,e),t},t}),{}),L=K.reduce((function(t,r){return t[r]=G[r].cancel,t}),{}),z=function(t){return G[t].process(B)},J=function(t){R=!1,B.delta=I?$:Math.max(Math.min(t-B.timestamp,40),1),I||($=B.delta),B.timestamp=t,W=!0,K.forEach(z),W=!1,R&&(I=!1,N(J))},Q=function(){R=!0,I=!0,W||N(J)},X=function(){return B},Y=function(t){return function(r){return 1-t(1-r)}},Z=function(t){return function(r){return r<=.5?t(2*r)/2:(2-t(2*(1-r)))/2}},tt=Y,rt=function(t){return t},nt=function(t){return function(r){return Math.pow(r,t)}}(2),et=Y(nt),ot=Z(nt),ut=function(t){return"number"==typeof t},it=(S=function(t,r,n){return Math.min(Math.max(n,t),r)},function(t,r,n){return void 0!==n?S(t,r,n):function(n){return S(t,r,n)}}),at=function(t,r,n){var e=r-t;return 0===e?1:(n-t)/e},st=function(t,r,n){return-n*t+n*r+t},ct=function(t,r,n){var e=t*t,o=r*r;return Math.sqrt(Math.max(0,n*(o-e)+e))},ft=[F,j,P],pt=function(t){return ft.find((function(r){return r.test(t)}))},dt=function(t,r){var n=pt(t),o=pt(r);n.transform,o.transform;var u=n.parse(t),i=o.parse(r),a=e({},u),s=n===P?st:ct;return function(t){for(var r in a)"alpha"!==r&&(a[r]=s(u[r],i[r],t));return a.alpha=st(u.alpha,i.alpha,t),n.transform(a)}},lt=function(t,r){return function(n){return r(t(n))}},vt=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.reduce(lt)};var ht=function(t,r){var n=u(t),e=n.length,o=t.map((function(t,n){return e=t,o=r[n],ut(e)?function(t){return st(e,o,t)}:V(e)?dt(e,o):yt(e,o);var e,o}));return function(t){for(var r=0;r<e;r++)n[r]=o[r](t);return n}};function mt(t){for(var r=_.parse(t),n=r.length,e=0,o=0,u=0,i=0;i<n;i++)e||"number"==typeof r[i]?e++:void 0!==r[i].hue?u++:o++;return{parsed:r,numNumbers:e,numRGB:o,numHSL:u}}var yt=function(t,r){var n=_.createTransformer(r),e=mt(t),o=mt(r);return vt(ht(e.parsed,o.parsed),n)},gt=function(t,r){return ut(t)?t/(1e3/r):0},bt=function(t,r){return r?t*(1e3/r):0},wt=(it(0,1),function(){function t(t){void 0===t&&(t={}),this.props=t}return t.prototype.create=function(r){return new t(r)},t.prototype.start=function(t){void 0===t&&(t={});var r=!1,n={stop:function(){}},u=this.props,i=u.init,s=o(u,["init"]),c=i(a(t,s,(function(){r=!0,n.stop()})));return n=c?e(e({},n),c):n,r&&n.stop(),n},t.prototype.applyMiddleware=function(t){return this.create(e(e({},this.props),{middleware:this.props.middleware?u([t],this.props.middleware):[t]}))},t.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=1===t.length?t[0]:vt.apply(void 0,t);return this.applyMiddleware((function(t){return function(r){return t(n(r))}}))},t.prototype.while=function(t){return this.applyMiddleware((function(r,n){return function(e){return t(e)?r(e):n()}}))},t}()),Ot=function(t){return new wt({init:t})},Mt=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.subscribers=[],r}return n(r,t),r.prototype.complete=function(){this.subscribers.forEach((function(t){return t.complete()}))},r.prototype.error=function(t){this.subscribers.forEach((function(r){return r.error(t)}))},r.prototype.update=function(t){for(var r=0;r<this.subscribers.length;r++)this.subscribers[r].update(t)},r.prototype.subscribe=function(t){var r=this,n=a(t,this.props);return this.subscribers.push(n),{unsubscribe:function(){var t=r.subscribers.indexOf(n);-1!==t&&r.subscribers.splice(t,1)}}},r.prototype.stop=function(){this.parent&&this.parent.stop()},r}(function(){function t(t){void 0===t&&(t={}),this.props=t}return t.prototype.applyMiddleware=function(t){return this.create(e(e({},this.props),{middleware:this.props.middleware?u([t],this.props.middleware):[t]}))},t.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=1===t.length?t[0]:vt.apply(void 0,t);return this.applyMiddleware((function(t){return function(r){return t(n(r))}}))},t.prototype.while=function(t){return this.applyMiddleware((function(r,n){return function(e){return t(e)?r(e):n()}}))},t.prototype.filter=function(t){return this.applyMiddleware((function(r){return function(n){return t(n)&&r(n)}}))},t}()),At=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return n(r,t),r.prototype.create=function(t){return new r(t)},r}(Mt),xt=function(t){function r(r){var n=t.call(this,r)||this;return n.prev=n.current=r.value||0,n.scheduleVelocityCheck=function(){H.postRender(n.velocityCheck)},n.velocityCheck=function(t){t.timestamp!==n.lastUpdated&&(n.prev=n.current)},n.updateCurrent=function(t){return n.current=t},n.getVelocityOfCurrent=function(){return n.getSingleVelocity(n.current,n.prev)},r.initialSubscription&&n.subscribe(r.initialSubscription),n}return n(r,t),r.prototype.create=function(t){return new r(t)},r.prototype.get=function(){return this.current},r.prototype.getVelocity=function(){return this.getVelocityOfCurrent()},r.prototype.update=function(r){t.prototype.update.call(this,r),this.prev=this.current,this.updateCurrent(r);var n=X(),e=n.delta,o=n.timestamp;this.timeDelta=e,this.lastUpdated=o,this.scheduleVelocityCheck()},r.prototype.subscribe=function(r){var n=t.prototype.subscribe.call(this,r);return this.subscribers[this.subscribers.length-1].update(this.current),n},r.prototype.getSingleVelocity=function(t,r){return"number"==typeof t&&"number"==typeof r?bt(t-r,this.timeDelta):bt(parseFloat(t)-parseFloat(r),this.timeDelta)||0},r}(Mt),Ct=[g,y,m,b,w],kt=function(t){return Ct.find((function(r){return r.test(t)}))},St=function(t,r){return t(r)},jt=function(t,r){var n=r.from,u=r.to,i=o(r,["from","to"]),a=kt(n)||kt(u),s=a.transform,c=a.parse;return t(e(e({},i),{from:"string"==typeof n?c(n):n,to:"string"==typeof u?c(u):u})).pipe(s)},Pt=function(t){return function(r,n){var u=n.from,i=n.to,a=o(n,["from","to"]);return r(e(e({},a),{from:0,to:1})).pipe(t(u,i))}},Ft=Pt(dt),Vt=Pt(yt),Et=function(t,r){var n=function(t){var r=Object.keys(t),n=function(r,n){return void 0!==r&&!t[n](r)};return{getVectorKeys:function(t){return r.reduce((function(r,e){return n(t[e],e)&&r.push(e),r}),[])},testVectorProps:function(t){return t&&r.some((function(r){return n(t[r],r)}))}}}(r),e=n.testVectorProps,o=n.getVectorKeys;return function(r){if(!e(r))return t(r);var n=o(r),u=r[n[0]];return Tt(u)(t,r,n)}},Tt=function(t){return"number"==typeof t?St:function(t){return Boolean(kt(t))}(t)?jt:V(t)?Ft:_.test(t)?Vt:St},Dt=function(t){return void 0===t&&(t={}),Ot((function(r){var n=r.complete,e=r.update,o=t.velocity,u=void 0===o?0:o,i=t.from,a=void 0===i?0:i,s=t.power,c=void 0===s?.8:s,f=t.timeConstant,p=void 0===f?350:f,d=t.restDelta,l=void 0===d?.5:d,v=t.modifyTarget,h=0,m=c*u,y=a+m,g=void 0===v?y:v(y);g!==y&&(m=g-a);var b=H.update((function(t){var r=t.delta;h+=r;var o=-m*Math.exp(-h/p),u=o>l||o<-l;e(u?g+o:g),u||(L.update(b),n())}),!0);return{stop:function(){return L.update(b)}}}))},_t=Et(Dt,{from:l.test,modifyTarget:function(t){return"function"==typeof t},velocity:l.test}),qt=function(t){return void 0===t&&(t={}),Ot((function(r){var n=r.update,e=r.complete,o=t.velocity,u=void 0===o?0:o,i=t.from,a=void 0===i?0:i,s=t.to,c=void 0===s?0:s,f=t.stiffness,p=void 0===f?100:f,d=t.damping,l=void 0===d?10:d,v=t.mass,h=void 0===v?1:v,m=t.restSpeed,y=void 0===m?.01:m,g=t.restDelta,b=void 0===g?.01:g,w=u?-u/1e3:0,O=0,M=c-a,A=a,x=A,C=H.update((function(t){var r=t.delta;O+=r;var o=l/(2*Math.sqrt(p*h)),i=Math.sqrt(p/h)/1e3;if(x=A,o<1){var a=Math.exp(-o*i*O),s=i*Math.sqrt(1-o*o);A=c-a*((w+o*i*M)/s*Math.sin(s*O)+M*Math.cos(s*O))}else{a=Math.exp(-i*O);A=c-a*(M+(w+i*M)*O)}u=bt(A-x,r);var f=Math.abs(u)<=y,d=Math.abs(c-A)<=b;f&&d?(n(A=c),L.update(C),e()):n(A)}),!0);return{stop:function(){return L.update(C)}}}))},Nt=Et(qt,{from:l.test,to:l.test,stiffness:l.test,damping:l.test,mass:l.test,velocity:l.test}),$t=Et((function(t){var r=t.from,n=void 0===r?0:r,o=t.velocity,u=void 0===o?0:o,i=t.min,a=t.max,s=t.power,c=void 0===s?.8:s,f=t.timeConstant,p=void 0===f?700:f,d=t.bounceStiffness,l=void 0===d?500:d,v=t.bounceDamping,h=void 0===v?10:v,m=t.restDelta,y=void 0===m?1:m,g=t.modifyTarget;return Ot((function(t){var r,o=t.update,s=t.complete,f=n,d=function(t){return void 0!==i&&t<i||void 0!==a&&t>a},v=function(t){return Math.abs(i-t)<Math.abs(a-t)?i:a},m=function(t,n){r&&r.stop(),r=t.start({update:o,complete:function(){n?n():s()}})},b=function(t){m(qt(e(e({},t),{stiffness:l,damping:h,restDelta:y})))};if(d(n))b({from:n,velocity:u,to:v(n)});else{var w=c*u+n;void 0!==g&&(w=g(w),g=void 0,u=(w-n)/c);var O=Dt({from:n,velocity:u,timeConstant:p,power:c,restDelta:y,modifyTarget:g}),M=void 0;if(d(w)){var A=v(w),x=A==i?-1:1;O=O.while((function(t){return u=bt(t-f,X().delta),f=t,A-t*x>0})),M=function(){return b({from:f,to:A,velocity:u})}}m(O,M)}return{stop:function(){return r&&r.stop()}}}))}),{from:l.test,velocity:l.test,min:l.test,max:l.test,damping:l.test,stiffness:l.test,modifyTarget:function(t){return"function"==typeof t}}),It=Et((function(t){var r=t.from,n=void 0===r?0:r,e=t.to,o=void 0===e?1:e,u=t.ease,i=void 0===u?rt:u,a=t.reverseEase;return void 0!==a&&a&&(i=tt(i)),Ot((function(t){var r=t.update;return{seek:function(t){return r(t)}}})).pipe(i,(function(t){return st(n,o,t)}))}),{ease:function(t){return"function"==typeof t},from:l.test,to:l.test}),Rt=it(0,1),Wt=function(t){return void 0===t&&(t={}),Ot((function(r){var n,e=r.update,o=r.complete,u=t.duration,i=void 0===u?300:u,a=t.ease,s=void 0===a?et:a,c=t.flip,f=void 0===c?0:c,p=t.loop,d=void 0===p?0:p,l=t.yoyo,v=void 0===l?0:l,h=t.repeatDelay,m=void 0===h?0:h,y=t.from,g=void 0===y?0:y,b=t.to,w=void 0===b?1:b,O=t.elapsed,M=void 0===O?0:O,A=t.flipCount,x=void 0===A?0:A,C=t.yoyoCount,k=void 0===C?0:C,S=t.loopCount,j=void 0===S?0:S,P=It({from:g,to:w,ease:s}).start(e),F=0,V=!1,E=function(t){var r;void 0===t&&(t=!1),P=It({from:g=(r=[w,g])[0],to:w=r[1],ease:s,reverseEase:t}).start(e)},T=function(){F=Rt(at(0,i,M)),P.seek(F)},D=function(){V=!0,n=H.update((function(t){var r,e=t.delta;M+=e,T(),!(r=V&&M>i+m)||(!r||d||f||v)&&(M=M-i-m,d&&j<d?(j++,1):f&&x<f?(x++,E(),1):v&&k<v&&(k++,E(k%2!=0),1))||(L.update(n),o&&H.update(o,!1,!0))}),!0)},_=function(){V=!1,n&&L.update(n)};return D(),{isActive:function(){return V},getElapsed:function(){return it(0,i,M)},getProgress:function(){return F},stop:function(){_()},pause:function(){return _(),this},resume:function(){return V||D(),this},seek:function(t){return M=st(0,i,t),H.update(T,!1,!0),this},reverse:function(){return E(),this}}}))},Bt=it(0,1),Kt=function(t){var r=t.easings,n=t.ease,u=void 0===n?rt:n,i=t.times,a=t.values,s=o(t,["easings","ease","times","values"]);r=Array.isArray(r)?r:function(t,r){return t.map((function(){return r||et})).splice(0,t.length-1)}(a,r),i=i||function(t){var r=t.length;return t.map((function(t,n){return 0!==n?n/(r-1):0}))}(a);var c=r.map((function(t,r){return It({from:a[r],to:a[r+1],ease:t})}));return Wt(e(e({},s),{ease:u})).applyMiddleware((function(t){return function(t,r,n){var e=t.length,o=e-1,u=o-1,i=r.map((function(t){return t.start(n)}));return function(r){r<=t[0]&&i[0].seek(0),r>=t[o]&&i[u].seek(1);for(var n=1;n<e&&!(t[n]>r||n===o);n++);var a=at(t[n-1],t[n],r);i[n-1].seek(Bt(a))}}(i,c,t)}))},Ut=Et((function(t){return void 0===t&&(t={}),Ot((function(r){var n=r.complete,e=r.update,o=t.acceleration,u=void 0===o?0:o,i=t.friction,a=void 0===i?0:i,s=t.velocity,c=void 0===s?0:s,f=t.springStrength,p=t.to,d=t.restSpeed,l=void 0===d?.001:d,v=t.from,h=void 0===v?0:v,m=H.update((function(t){var r=t.delta,o=Math.max(r,16);(u&&(c+=gt(u,o)),a&&(c*=Math.pow(1-a,o/100)),void 0!==f&&void 0!==p)&&(c+=(p-h)*gt(f,o));h+=gt(c,o),e(h),!1!==l&&(!c||Math.abs(c)<=l)&&(L.update(m),n())}),!0);return{set:function(t){return h=t,this},setAcceleration:function(t){return u=t,this},setFriction:function(t){return a=t,this},setSpringStrength:function(t){return f=t,this},setSpringTarget:function(t){return p=t,this},setVelocity:function(t){return c=t,this},stop:function(){return L.update(m)}}}))}),{acceleration:l.test,friction:l.test,velocity:l.test,from:l.test,to:l.test,springStrength:l.test}),Gt=function(t){var r=t.getCount,n=t.getFirst,e=t.getOutput,o=t.mapApi,u=t.setProp,i=t.startActions;return function(t){return Ot((function(a){var s=a.update,c=a.complete,f=a.error,p=r(t),d=e(),l=function(){return s(d)},v=0,h=i(t,(function(t,r){var n=!1;return t.start({complete:function(){n||(n=!0,++v===p&&H.update(c))},error:f,update:function(t){u(d,r,t),H.update(l,!1,!0)}})}));return Object.keys(n(h)).reduce((function(t,r){return t[r]=o(h,r),t}),{})}))}},Ht=Gt({getOutput:function(){return{}},getCount:function(t){return Object.keys(t).length},getFirst:function(t){return t[Object.keys(t)[0]]},mapApi:function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Object.keys(t).reduce((function(e,o){var u;return t[o][r]&&(n[0]&&void 0!==n[0][o]?e[o]=t[o][r](n[0][o]):e[o]=(u=t[o])[r].apply(u,n)),e}),{})}},setProp:function(t,r,n){return t[r]=n},startActions:function(t,r){return Object.keys(t).reduce((function(n,e){return n[e]=r(t[e],e),n}),{})}}),Lt=function(t,r){return Array.isArray(r)?t.push.apply(t,function(t){var r=[],n=t[t.length-1],e="number"==typeof n,o=e?n:0,u=e?t.slice(0,-1):t,i=u.length,a=0;return u.forEach((function(t,n){if(r.push(t),n!==i-1){var e=t.duration||300;a+=o,r.push("-"+(e-a))}})),r}(r)):t.push(r),t},zt=function(t,r,n){var e=t.duration,o=t.easings,u=t.times,i=t.values,a=i.length,s=u[a-1],c=0===r.at?0:r.at/e,f=(r.at+r.duration)/e;if(0===n)i.push(r.from),u.push(c);else if(s!==c){void 0!==r.from&&(i.push(i[a-1]),u.push(c),o.push(rt));var p=void 0!==r.from?r.from:i[a-1];i.push(p),u.push(c),o.push(rt)}else void 0!==r.from&&(i.push(r.from),u.push(c),o.push(rt));return i.push(r.to),u.push(f),o.push(r.ease||ot),t},Jt=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ot((function(r){var n,e=r.update,o=r.complete,u=0,i=function(){n=t[u].start({complete:function(){++u>=t.length?o():i()},update:e})};return i(),{stop:function(){return n&&n.stop()}}}))},Qt=Gt({getOutput:function(){return[]},getCount:function(t){return t.length},getFirst:function(t){return t[0]},mapApi:function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t.map((function(t,e){if(t[r])return Array.isArray(n[0])?t[r](n[0][e]):t[r].apply(t,n)}))}},setProp:function(t,r,n){return t[r]=n},startActions:function(t,r){return t.map((function(t,n){return r(t,n)}))}}),Xt=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Qt(t)},Yt=function(t){return Ot((function(r){var n=r.complete,e=setTimeout(n,t);return{stop:function(){return clearTimeout(e)}}}))};t.Action=wt,t.ValueReaction=xt,t.action=Ot,t.chain=Jt,t.composite=Ht,t.crossfade=function(t,r){return Ot((function(n){var o=0,u=Xt(t,r).start(e(e({},n),{update:function(t){var r=t[0],e=t[1];n.update(st(r,e,o))}}));return{setBalance:function(t){return o=t},stop:function(){return u.stop()}}}))},t.decay=_t,t.delay=Yt,t.everyFrame=function(){return Ot((function(t){var r=t.update,n=0,e=H.update((function(t){var e=t.timestamp;n||(n=e),r(e-n)}),!0,!0);return{stop:function(){return L.update(e)}}}))},t.inertia=$t,t.keyframes=Kt,t.merge=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ot((function(r){var n=t.map((function(t){return t.start(r)}));return{stop:function(){return n.forEach((function(t){return t.stop()}))}}}))},t.multicast=function(){return new At},t.parallel=Xt,t.physics=Ut,t.schedule=function(t,r){return Ot((function(n){var e,o=n.update,u=n.complete,i=t.start({update:function(){return void 0!==e&&o(e)},complete:u}),a=r.start({update:function(t){return e=t},complete:u});return{stop:function(){i.stop(),a.stop()}}}))},t.spring=Nt,t.stagger=function(t,r){var n="number"==typeof r,e=t.map((function(t,e){var o=n?r*e:r(e);return Jt(Yt(o),t)}));return Xt.apply(void 0,e)},t.styler=function(){},t.timeline=function(t,r){var n=void 0===r?{}:r,o=n.duration,u=n.elapsed,i=n.ease,a=n.loop,s=n.flip,c=n.yoyo,f=0,p=0,d=t.reduce(Lt,[]),l=[];d.forEach((function(t){if("string"==typeof t)f+=parseFloat(t);else if("number"==typeof t)f=t;else{var r=e(e({},t),{at:f});r.duration=void 0===r.duration?300:r.duration,l.push(r),f+=r.duration,p=Math.max(p,r.at+r.duration)}}));for(var v={},h=l.length,m=0;m<h;m++){var y=l[m],g=y.track;if(void 0===g)throw new Error("No track defined");v.hasOwnProperty(g)||(v[g]=[]),v[g].push(y)}var b={};for(var w in v)if(v.hasOwnProperty(w)){var O=v[w].reduce(zt,{duration:p,easings:[],times:[],values:[]});b[w]=Kt(e(e({},O),{duration:o||p,ease:i,elapsed:u,loop:a,yoyo:c,flip:s}))}return Ht(b)},t.tween=Wt,t.value=function(t,r){return new xt({value:t,initialSubscription:r})},Object.defineProperty(t,"__esModule",{value:!0})}));
